{
  "Name": "MakePurchase",
  "Constants": [
    {
      "Name": "Now",
      "Value": "|CurrentTime|"
    },
    {
      "Name": "CompanyId",
      "Value": "290411",
      "Type": "int"
    },
    {
      "Name": "CustomerId",
      "Value": "1809144",
      "Type": "int"
    },
    {
      "Name": "NEJ_AR_INTE_NOG",
      "Value": "P31541255"
    },
    {
      "Name": "DeliveryNoteNumber",
      "Value": "200000001",
      "Type": "seed"
    },
    {
      "Name": "OrderNumber",
      "Value": "174461",
      "Type": "int"
    },
    {
      "Name": "CountOrdered",
      "Value": "1",
      "Type": "int"
    }
  ],
  "Services": [
    {
      "Name": "Shopping",
      "BaseUrl": "https://b2l-shopping-stage.azurewebsites.net",
      "BasePath": "carts",
      "ApiKey": {
        "Name": "apiKey",
        "Value": "MER123"
      },
      "DefaultHeaders": [
        {
          "Name": "B2LCompanyId",
          "Value": "{{CompanyId}}"
        },
        {
          "Name": "B2LCustomerId",
          "Value": "{{CustomerId}}"
        }
      ],
      "Endpoints": [
        {
          "Name": "GetCurrent",
          "Method": "Get",
          "Path": "current"
        },
        {
          "Name": "AddItem",
          "Method": "Post",
          "Path": "{{CartId}}/items"
        }
      ]
    },
    {
      "Name": "Checkout",
      "BaseUrl": "https://b2l-shopping-stage.azurewebsites.net",
      "BasePath": "checkout/v2",
      "ApiKey": {
        "Name": "apiKey",
        "Value": "MER123"
      },
      "DefaultHeaders": [
        {
          "Name": "B2LCompanyId",
          "Value": "{{CompanyId}}"
        },
        {
          "Name": "B2LCustomerId",
          "Value": "{{CustomerId}}"
        }
      ],
      "Endpoints": [
        {
          "Name": "Purchase",
          "Method": "Post",
          "Path": "{{CartId}}/purchase"
        }
      ]
    },
    {
      "Name": "Order",
      "BaseUrl": "https://b2l-order-stage.azurewebsites.net",
      "BasePath": "orders",
      "ApiKey": {
        "Name": "apiKey",
        "Value": "MER123"
      },
      "Endpoints": [
        {
          "Name": "GetOrder",
          "Method": "Get",
          "Path": "{{OrderNumber}}"
        },
        {
          "Name": "Shipped",
          "Method": "Post",
          "Path": "{{OrderNumber}}/items/shipped"
        }
      ]
    }
  ],
  "Scenarios": [
    {
      "Name": "BuyAndDeliver",
      "Disabled": true,
      "Steps": [
        {
          "Endpoint": "Shopping.GetCurrent",
          "Response": {
            "id": "{{CartId:int}}",
            "count": "{{CountBefore:decimal->int}}"
          }
        },
        {
          "Endpoint": "Shopping.AddItem",
          "Args": "sku={{NEJ_AR_INTE_NOG}}&quantity=1",
          "Response": {
            "count": "{{CountOrdered:decimal->int}}"
          }
        },
        {
          "Endpoint": "Checkout.Purchase",
          "Body": {
            "ipAddress": "172.16.5.115",
            "cartId": "{{CartId}}",
            "deliveryAddress": {
              "careOf": "Företaget",
              "line1": "Gatan 1",
              "zip": "61430",
              "city": "Söderköping",
              "shippingPhoneNumber": "0123456789"
            },
            "invoiceReference": {
              "reference1": "123",
              "reference2": "456"
            }
          },
          "Response": {
            "orderNumber": "{{OrderNumber:int}}"
          }
        },
        {
          "Endpoint": "Order.GetOrder",
          "Response": {
            "status": "Confirmed",
            "orderNo": "{{WebOrderNumber:int}}",
            "externalOrderRef": "{{LogisticsOrderNumber:int}}"
          },
          "DelayMs": 3000,
          "Times": 10,
          "BreakOnSuccess": true,
          "RetryOnFail": true
        },
        {
          "Endpoint": "Order.Shipped",
          "Body": {
            "externalOrderRef": "{{LogisticsOrderNumber}}",
            "eventTime": "{{Now}}",
            "deliveryNoteNumber": "{{DeliveryNoteNumber}}",
            "packageNumber": "{{DeliveryNoteNumber}}",
            "trackingLink": "",
            "carrier": "",
            "items": [
              {
                "rowNumber": "1",
                "sku": "{{NEJ_AR_INTE_NOG}}",
                "quantity": "{{CountOrdered}}"
              }
            ]
          }
        }
      ],
      "Asserts": [
        {
          "Name": "WebOrderNumber",
          "Value": "{{CartId}}"
        }
      ]
    },
    {
      "Name": "GetOrderAndDeliver",
      "Steps": [
        {
          "Endpoint": "Order.GetOrder",
          "Response": {
            "status": "Confirmed",
            "orderNo": "{{WebOrderNumber:int}}",
            "externalOrderRef": "{{LogisticsOrderNumber:int}}"
          },
          "DelayMs": 3000,
          "Times": 10,
          "BreakOnSuccess": true,
          "RetryOnFail": true
        },
        {
          "Endpoint": "Order.Shipped",
          "Body": {
            "externalOrderRef": "{{LogisticsOrderNumber}}",
            "eventTime": "{{Now}}",
            "deliveryNoteNumber": "{{DeliveryNoteNumber}}",
            "packageNumber": "{{DeliveryNoteNumber}}",
            "trackingLink": "",
            "carrier": "",
            "items": [
              {
                "rowNumber": "1",
                "sku": "{{NEJ_AR_INTE_NOG}}",
                "quantity": "{{CountOrdered}}"
              }
            ]
          }
        }
      ]
    }
  ]
}